import { Meta, Story, Controls, Canvas, ArgTypes } from '@storybook/blocks';
import * as ListboxStories from './Listbox.stories';
import { Listbox } from './Listbox';
import { IconSquareCheck, IconSquare } from '@tabler/icons-react';

<Meta of={ListboxStories} />

# Listbox Component

The Listbox component displays a list of selectable options, supporting both single and multiple selection modes.

## Overview

Listboxes are used to present a list of options for users to select from. They're commonly used in dropdowns, menus, and selection contexts. The Listbox component supports rich features like icons, help text, dividers, and multi-select behavior.

## Import

```jsx
import { Listbox } from '@tagaddod/react';
```

## Props

<ArgTypes of={Listbox} />

## Basic Usage

<Canvas of={ListboxStories.Basic} />

```jsx
<Listbox
  options={[
    { label: 'Option 1', value: 'option1' },
    { label: 'Option 2', value: 'option2' },
    { label: 'Option 3', value: 'option3' },
    { label: 'Option 4', value: 'option4' },
  ]}
  selectedValue="option1"
  onSelect={(value) => console.log('Selected:', value)}
/>
```

## With Icons

You can add icons before options (prefix) and additional content after options (suffix).

<Canvas of={ListboxStories.WithIcons} />

```jsx
import { IconCheck, IconTag, IconStar } from '@tabler/icons-react';

<Listbox
  options={[
    { 
      label: 'Selected Option', 
      value: 'selected',
      prefix: <IconCheck size={16} />
    },
    { 
      label: 'Tagged Items', 
      value: 'tagged',
      prefix: <IconTag size={16} />,
      suffix: <span style={{fontSize: '12px', color: 'var(--t-color-text-subtle)'}}>12</span>
    },
    { 
      label: 'Favorites', 
      value: 'favorites',
      prefix: <IconStar size={16} />,
      suffix: <span style={{fontSize: '12px', color: 'var(--t-color-text-subtle)'}}>5</span>
    },
  ]}
  selectedValue="selected"
  onSelect={(value) => console.log('Selected:', value)}
/>
```

## With Help Text

The Listbox supports adding descriptive help text to options.

<Canvas of={ListboxStories.WithHelpText} />

```jsx
<Listbox
  options={[
    { 
      label: 'Product Settings', 
      value: 'product',
      helpText: 'Manage product inventory and variations'
    },
    { 
      label: 'User Accounts', 
      value: 'users',
      helpText: 'Modify user permissions and access'
    },
    { 
      label: 'Payment Options', 
      value: 'payment',
      helpText: 'Configure available payment methods'
    },
  ]}
  selectedValue="product"
  onSelect={(value) => console.log('Selected:', value)}
/>
```

## Multiple Selection

The Listbox can be configured to allow multiple selections.

<Canvas of={ListboxStories.MultiSelect} />

```jsx
import { useState } from 'react';
import { IconSquareCheck, IconSquare } from '@tabler/icons-react';

function MultiSelectExample() {
  const [selected, setSelected] = useState(['option1', 'option3']);
  
  return (
    <Listbox
      options={[
        { 
          label: 'Option 1', 
          value: 'option1',
          prefix: selected.includes('option1') ? <IconSquareCheck size={16} /> : <IconSquare size={16} />
        },
        { 
          label: 'Option 2', 
          value: 'option2',
          prefix: selected.includes('option2') ? <IconSquareCheck size={16} /> : <IconSquare size={16} />
        },
        { 
          label: 'Option 3', 
          value: 'option3',
          prefix: selected.includes('option3') ? <IconSquareCheck size={16} /> : <IconSquare size={16} />
        },
        { 
          label: 'Option 4', 
          value: 'option4',
          prefix: selected.includes('option4') ? <IconSquareCheck size={16} /> : <IconSquare size={16} />
        },
      ]}
      selectedValue={selected}
      multiple={true}
      onMultiSelect={setSelected}
    />
  );
}
```

## Disabled Options

Individual options can be disabled.

<Canvas of={ListboxStories.WithDisabledOptions} />

```jsx
<Listbox
  options={[
    { label: 'Available Option', value: 'available' },
    { label: 'Disabled Option', value: 'disabled', disabled: true },
    { label: 'Another Available', value: 'another' },
    { label: 'Currently Unavailable', value: 'unavailable', disabled: true },
  ]}
  selectedValue="available"
  onSelect={(value) => console.log('Selected:', value)}
/>
```

## With Dividers

Add dividers to visually separate groups of options.

<Canvas of={ListboxStories.WithDividers} />

```jsx
<Listbox
  options={[
    { label: 'Recent', value: 'recent', divider: true },
    { label: 'Yesterday', value: 'yesterday' },
    { label: 'Last Week', value: 'lastWeek', divider: true },
    { label: 'Last Month', value: 'lastMonth' },
    { label: 'Older', value: 'older' },
  ]}
  selectedValue="yesterday"
  onSelect={(value) => console.log('Selected:', value)}
/>
```

## In Popover

The Listbox component can be used inside a Popover for dropdown menus.

<Canvas of={ListboxStories.InPopover} />

```jsx
import { useState } from 'react';
import { 
  Popover, 
  PopoverContent, 
  PopoverTrigger, 
  PopoverRoot 
} from '@tagaddod/react';
import { IconChevronDown } from '@tabler/icons-react';

function DropdownExample() {
  const [selectedOption, setSelectedOption] = useState('filter1');
  const [open, setOpen] = useState(false);
  
  const options = [
    { label: 'Filter by Date', value: 'filter1' },
    { label: 'Filter by Status', value: 'filter2' },
    { label: 'Filter by Category', value: 'filter3' },
    { label: 'Filter by Priority', value: 'filter4' },
    { label: 'Filter by Assignee', value: 'filter5' },
  ];
  
  const selectedLabel = options.find(opt => opt.value === selectedOption)?.label || 'Select...';
  
  return (
    <PopoverRoot open={open} onOpenChange={setOpen}>
      <PopoverTrigger asChild>
        <button className="dropdown-button">
          {selectedLabel}
          <IconChevronDown size={16} />
        </button>
      </PopoverTrigger>
      <PopoverContent>
        <Listbox
          options={options}
          selectedValue={selectedOption}
          onSelect={(value) => {
            setSelectedOption(value.toString());
            setOpen(false);
          }}
          inPopover={true}
        />
      </PopoverContent>
    </PopoverRoot>
  );
}
```

## Internationalization

The Listbox component properly handles Right-to-Left (RTL) languages by:

1. Adjusting layout direction for RTL text flow
2. Applying appropriate line height for Arabic text
3. Correctly aligning text and content in RTL contexts

<Canvas of={ListboxStories.ArabicRTL} />

```jsx
<div dir="rtl">
  <Listbox
    options={[
      { label: 'الخيار الأول', value: 'option1' },
      { label: 'الخيار الثاني', value: 'option2' },
      { label: 'الخيار الثالث', value: 'option3', helpText: 'نص توضيحي للمساعدة' },
    ]}
    selectedValue="option1"
    onSelect={(value) => console.log('Selected:', value)}
  />
</div>
```

## Custom Content

You can use the `customContent` prop to provide completely custom content for list options:

```jsx
<Listbox
  options={[
    { 
      label: "Custom Option", // Required but not shown
      value: "custom1", 
      customContent: (
        <div style={{ 
          display: 'flex', 
          flexDirection: 'column',
          padding: '4px 0'
        }}>
          <span style={{ fontWeight: 'bold' }}>Custom Option</span>
          <div style={{ 
            display: 'flex', 
            gap: '8px', 
            alignItems: 'center',
            marginTop: '4px' 
          }}>
            <span style={{ 
              background: '#e8f6ff', 
              padding: '2px 6px', 
              borderRadius: '4px',
              fontSize: '12px'
            }}>
              Tag 1
            </span>
            <span style={{ 
              background: '#fff0e8', 
              padding: '2px 6px', 
              borderRadius: '4px',
              fontSize: '12px'
            }}>
              Tag 2
            </span>
          </div>
        </div>
      )
    },
    // More options...
  ]}
  selectedValue="custom1"
  onSelect={(value) => console.log('Selected:', value)}
/>
```

## Max Visible Options

You can limit the number of visible options with the `maxVisibleOptions` prop:

```jsx
<Listbox
  options={[
    { label: 'Option 1', value: 'option1' },
    { label: 'Option 2', value: 'option2' },
    { label: 'Option 3', value: 'option3' },
    { label: 'Option 4', value: 'option4' },
    { label: 'Option 5', value: 'option5' },
    { label: 'Option 6', value: 'option6' },
    { label: 'Option 7', value: 'option7' },
  ]}
  selectedValue="option1"
  maxVisibleOptions={3}
  onSelect={(value) => console.log('Selected:', value)}
/>
```

## Use Cases

### Dropdown Menus

```jsx
<PopoverRoot>
  <PopoverTrigger>
    <Button>Open Menu</Button>
  </PopoverTrigger>
  <PopoverContent>
    <Listbox
      options={[
        { label: 'Edit', value: 'edit', prefix: <IconEdit size={16} /> },
        { label: 'Duplicate', value: 'duplicate', prefix: <IconCopy size={16} /> },
        { label: 'Archive', value: 'archive', prefix: <IconArchive size={16} /> },
        { label: 'Delete', value: 'delete', prefix: <IconTrash size={16} /> },
      ]}
      onSelect={handleMenuAction}
      inPopover={true}
    />
  </PopoverContent>
</PopoverRoot>
```

### Filter Selections

```jsx
<Listbox
  options={[
    { 
      label: 'All Tasks', 
      value: 'all',
      helpText: 'Show tasks from all projects'
    },
    { 
      label: 'My Tasks', 
      value: 'my',
      helpText: 'Only show tasks assigned to me'
    },
    { 
      label: 'Completed', 
      value: 'completed',
      helpText: 'Show only completed tasks'
    },
  ]}
  selectedValue={filterValue}
  onSelect={setFilterValue}
/>
```

### Checkbox Lists

```jsx
<Listbox
  options={permissions.map(perm => ({
    label: perm.name,
    value: perm.id,
    helpText: perm.description,
    prefix: selectedPermissions.includes(perm.id) ? <IconSquareCheck size={16} /> : <IconSquare size={16} />
  }))}
  selectedValue={selectedPermissions}
  multiple={true}
  onMultiSelect={setSelectedPermissions}
/>
```

## Accessibility

- The component follows WAI-ARIA listbox pattern with proper roles and attributes
- Uses `role="listbox"` and `aria-multiselectable` for multiple selection
- Each option has `role="option"` and appropriate `aria-selected` state
- Supports keyboard navigation (arrow keys, Home/End, Enter)
- Provides accessible focus management
- Maintains a logical tab order
- Uses proper ARIA attributes for selected state

## Implementation Details

### CSS Variables

The Listbox component uses the following token CSS variables:

| Variable | Purpose |
|----------|---------|
| `--t-space-*` | Padding and spacing |
| `--t-color-surface-*` | Background colors |
| `--t-color-text-*` | Text colors |
| `--t-color-border-*` | Border colors |
| `--t-font-family-body` | Text font |
| `--t-font-size-body-*` | Font sizes |
| `--t-font-weight-*` | Font weights |
| `--t-border-radius-200` | Border radius |
| `--t-color-border-focus` | Focus outline color |
| `--t-line-height-arabic` | Line height for Arabic text |
| `--t-line-height-english` | Line height for English text |

### Architecture

The Listbox component consists of two main parts:

1. **Listbox**: The container component that manages the list options, selection state, and keyboard navigation
2. **ListboxOption**: The individual option component that renders each selectable item

This architecture provides:

- Clean separation of concerns
- Flexible option configuration
- Proper event handling
- Accessibility compliance

### Browser Support

The Listbox component is compatible with all modern browsers and includes RTL language support.
