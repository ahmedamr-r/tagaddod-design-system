import { Meta, Story, Controls, Canvas, ArgTypes } from '@storybook/blocks';
import * as DrawerStories from './Drawer.stories';
import { Drawer, useDrawerContext } from './Drawer';

<Meta of={DrawerStories} />

# Drawer Component

The Drawer component is a side panel that slides in from the edge of the screen, providing additional content or actions without navigating away from the current page. It features proper z-index management to ensure it appears above all other content, including complex table layouts.

## Overview

Drawers are used to display supplementary content, forms, or detailed information while keeping the main context visible. They can appear from the right or left side of the screen and come in different sizes. The component automatically handles z-index stacking issues and provides context for nested modal components.

## Import

```jsx
import { Drawer, useDrawerContext } from '@tagaddod/react';
```

## Props

<ArgTypes of={Drawer} />

## Z-Index Management

The Drawer component uses a sophisticated z-index hierarchy to ensure proper layering:

- **Drawer Overlay**: `z-index: 140` - Above all content but below drawer content
- **Drawer Content**: `z-index: 150` - Above overlay and all page content (including tables)
- **Modals from Drawer**: `z-index: 200` - For modal components opened from within the drawer

This hierarchy ensures the drawer always appears above table content, sticky headers, and other high z-index elements.

## Basic Usage

<Canvas of={DrawerStories.Default} />

```jsx
import { useState } from 'react';
import { Drawer, Button } from '@tagaddod/react';

function MyComponent() {
  const [open, setOpen] = useState(false);
  
  return (
    <>
      <Button onClick={() => setOpen(true)}>
        Open Drawer
      </Button>
      
      <Drawer
        open={open}
        onOpenChange={setOpen}
        title="Drawer Title"
        contentPadding="var(--t-space-500)" // Default 20px padding
      >
        <div style={{ padding: '16px 0' }}>
          <p>This is a default drawer content.</p>
          <p>You can place any content here.</p>
        </div>
      </Drawer>
    </>
  );
}
```

## Sizes

The Drawer component comes in three sizes:

### Medium (Default)

<Canvas of={DrawerStories.Default} />

```jsx
<Drawer
  open={open}
  onOpenChange={setOpen}
  title="Medium Drawer"
  size="medium"
>
  {/* Content */}
</Drawer>
```

### Small

```jsx
<Drawer
  open={open}
  onOpenChange={setOpen}
  title="Small Drawer"
  size="small"
>
  {/* Content */}
</Drawer>
```

### Large

<Canvas of={DrawerStories.LargeDrawer} />

```jsx
<Drawer
  open={open}
  onOpenChange={setOpen}
  title="Large Drawer"
  size="large"
>
  {/* Content */}
</Drawer>
```

## Positions

The Drawer can appear from either side of the screen:

### Right (Default)

<Canvas of={DrawerStories.Default} />

```jsx
<Drawer
  open={open}
  onOpenChange={setOpen}
  title="Right Drawer"
  position="right"
>
  {/* Content */}
</Drawer>
```

### Left

```jsx
<Drawer
  open={open}
  onOpenChange={setOpen}
  title="Left Drawer"
  position="left"
>
  {/* Content */}
</Drawer>
```

## Header Options

### With Back Button

<Canvas of={DrawerStories.WithBackButton} />

```jsx
<Drawer
  open={open}
  onOpenChange={setOpen}
  title="Step 1 of 3"
  showBackButton={true}
  onBackClick={handleBack}
>
  {/* Content */}
</Drawer>
```

### With Header Components

<Canvas of={DrawerStories.WithHeaderComponents} />

```jsx
<Drawer
  open={open}
  onOpenChange={setOpen}
  title="Drawer with Header Components"
  headerPrefix={<span className="badge">Badge</span>}
  headerSuffix={<Button variant="plain" size="micro">Action</Button>}
>
  {/* Content */}
</Drawer>
```

### Without Title

```jsx
<Drawer
  open={open}
  onOpenChange={setOpen}
  showTitle={false}
>
  {/* Content */}
</Drawer>
```

### Without Close Button

```jsx
<Drawer
  open={open}
  onOpenChange={setOpen}
  title="Without Close Button"
  showClose={false}
>
  {/* Content */}
</Drawer>
```

## Footer

The Drawer component supports multiple footer variants to accommodate different use cases and workflows.

### Footer Variants

#### Cancel and Actions (Default)

Shows a cancel button on the left and action buttons on the right. This is the most common pattern for forms and dialogs.

<Canvas of={DrawerStories.FooterCancelAndActions} />

```jsx
<Drawer
  open={open}
  onOpenChange={setOpen}
  title="Cancel and Actions Footer"
  showFooter={true}
  footerVariant="cancelAndActions"
  cancelLabel="Cancel"
  primaryLabel="Save Changes"
  secondaryLabel="Save Draft"
  onCancel={() => setOpen(false)}
  onPrimary={() => {
    // Save action
    setOpen(false);
  }}
  onSecondary={() => {
    // Secondary action
  }}
  showPrimaryButton={true}
  showSecondaryButton={true}
>
  {/* Content */}
</Drawer>
```

#### Swap and Actions

Shows custom content on the left (like status or metadata) and action buttons on the right.

<Canvas of={DrawerStories.FooterSwapAndActions} />

```jsx
<Drawer
  open={open}
  onOpenChange={setOpen}
  title="Swap and Actions Footer"
  showFooter={true}
  footerVariant="swapAndActions"
  primaryLabel="Publish"
  secondaryLabel="Save Draft"
  swapContent={
    <span style={{ color: 'var(--t-color-text-secondary)' }}>
      Status: Draft
    </span>
  }
  onPrimary={() => setOpen(false)}
  onSecondary={() => {}}
  showPrimaryButton={true}
  showSecondaryButton={true}
>
  {/* Content */}
</Drawer>
```

#### Actions Only

Shows only action buttons aligned to the right. Perfect for workflows where canceling is done via the close button.

<Canvas of={DrawerStories.FooterActionsOnly} />

```jsx
<Drawer
  open={open}
  onOpenChange={setOpen}
  title="Actions Only Footer"
  showFooter={true}
  footerVariant="actionsOnly"
  primaryLabel="Confirm"
  secondaryLabel="Review"
  onPrimary={() => setOpen(false)}
  onSecondary={() => {}}
  showPrimaryButton={true}
  showSecondaryButton={true}
>
  {/* Content */}
</Drawer>
```

### Single Button Footers

#### Primary Button Only

<Canvas of={DrawerStories.FooterPrimaryOnly} />

```jsx
<Drawer
  open={open}
  onOpenChange={setOpen}
  title="Primary Button Only"
  showFooter={true}
  footerVariant="actionsOnly"
  primaryLabel="Understand"
  onPrimary={() => setOpen(false)}
  showPrimaryButton={true}
  showSecondaryButton={false}
>
  {/* Content */}
</Drawer>
```

#### Secondary Button Only

<Canvas of={DrawerStories.FooterSecondaryOnly} />

```jsx
<Drawer
  open={open}
  onOpenChange={setOpen}
  title="Secondary Button Only"
  showFooter={true}
  footerVariant="actionsOnly"
  secondaryLabel="Maybe Later"
  onSecondary={() => setOpen(false)}
  showPrimaryButton={false}
  showSecondaryButton={true}
>
  {/* Content */}
</Drawer>
```

### Footer Props

| Prop | Type | Default | Description |
|------|------|---------|-------------|
| `footerVariant` | `'cancelAndActions' \| 'swapAndActions' \| 'actionsOnly'` | `'cancelAndActions'` | The footer layout variant |
| `cancelLabel` | `string` | `'Cancel'` | Label for the cancel button |
| `primaryLabel` | `string` | `'Label'` | Label for the primary button |
| `secondaryLabel` | `string` | `'Label'` | Label for the secondary button |
| `showPrimaryButton` | `boolean` | `true` | Whether to show the primary button |
| `showSecondaryButton` | `boolean` | `true` | Whether to show the secondary button |
| `swapContent` | `React.ReactNode` | - | Custom content for the swap area |
| `onCancel` | `() => void` | - | Cancel button callback |
| `onPrimary` | `() => void` | - | Primary button callback |
| `onSecondary` | `() => void` | - | Secondary button callback |

## Modal Components Within Drawer

When you need to open modal components (like dialogs, popovers, or dropdowns) from within a drawer, use the `useDrawerContext` hook to ensure proper z-index layering:

```jsx
import { useState } from 'react';
import { Drawer, useDrawerContext, Modal, Button } from '@tagaddod/react';

function DrawerWithModal() {
  const [drawerOpen, setDrawerOpen] = useState(false);
  const [modalOpen, setModalOpen] = useState(false);
  
  return (
    <>
      <Button onClick={() => setDrawerOpen(true)}>
        Open Drawer
      </Button>
      
      <Drawer
        open={drawerOpen}
        onOpenChange={setDrawerOpen}
        title="Drawer with Modal"
      >
        <div style={{ padding: '16px 0' }}>
          <p>This drawer contains a modal that will appear above it.</p>
          
          <Button onClick={() => setModalOpen(true)}>
            Open Modal
          </Button>
          
          <ModalFromDrawer 
            open={modalOpen} 
            onOpenChange={setModalOpen} 
          />
        </div>
      </Drawer>
    </>
  );
}

function ModalFromDrawer({ open, onOpenChange }) {
  const { isInsideDrawer, drawerZIndex } = useDrawerContext();
  
  return (
    <Modal
      open={open}
      onOpenChange={onOpenChange}
      title="Modal from Drawer"
      // Use drawerZIndex to ensure modal appears above drawer
      style={{ zIndex: isInsideDrawer ? drawerZIndex : undefined }}
    >
      <p>This modal appears above the drawer!</p>
    </Modal>
  );
}
```

### useDrawerContext Hook

The `useDrawerContext` hook provides information about the drawer context:

```jsx
import { useDrawerContext } from '@tagaddod/react';

function ComponentInDrawer() {
  const { isInsideDrawer, drawerZIndex } = useDrawerContext();
  
  if (isInsideDrawer) {
    // Component is inside a drawer
    // Use drawerZIndex for proper z-index layering
  }
  
  return <div>Component content</div>;
}
```

**Returns:**
- `isInsideDrawer: boolean` - Whether the component is rendered inside a drawer
- `drawerZIndex: number` - The z-index value to use for modals opened from the drawer (200)

## Visual Customization

### Custom Padding

<Canvas of={DrawerStories.CustomPadding} />

```jsx
<Drawer
  open={open}
  onOpenChange={setOpen}
  title="Custom Padding Drawer"
  contentPadding="var(--t-space-600)" // 24px padding instead of default 20px
>
  {/* Content */}
</Drawer>
```

The default content padding is `var(--t-space-500)` (20px). You can customize it using design tokens:

- `var(--t-space-300)` = 12px (0.75rem)
- `var(--t-space-400)` = 16px (1rem)
- `var(--t-space-500)` = 20px (1.25rem) - default
- `var(--t-space-600)` = 24px (1.5rem)
- `var(--t-space-700)` = 32px (2rem)

Or use custom values like `"2rem 1rem"` for different vertical and horizontal padding.


### Full Height

<Canvas of={DrawerStories.FullHeightDrawer} />

```jsx
<Drawer
  open={open}
  onOpenChange={setOpen}
  title="Full Height Drawer"
  fullHeight={true}
>
  {/* Content */}
</Drawer>
```

## Internationalization

The Drawer component properly handles Right-to-Left (RTL) languages automatically by:

1. Switching the position (right becomes left and vice versa)
2. Flipping the direction of the back button icon
3. Applying appropriate line height for Arabic text
4. Ensuring correct alignment of text and buttons

<Canvas of={DrawerStories.RTLDrawer} />

```jsx
<div dir="rtl">
  <Drawer
    open={open}
    onOpenChange={setOpen}
    title="عنوان الدرج"
    showBackButton={true}
    showFooter={true}
    primaryAction={{
      label: 'حفظ',
      onClick: () => setOpen(false),
    }}
    secondaryAction={{
      label: 'إلغاء',
      onClick: () => setOpen(false),
    }}
  >
    <div style={{ textAlign: 'right' }}>
      <p>هذا محتوى الدرج باللغة العربية.</p>
    </div>
  </Drawer>
</div>
```

## Use Cases

### Form Entry

```jsx
<Drawer
  open={open}
  onOpenChange={setOpen}
  title="Add New User"
  contentPadding="var(--t-space-600)" // Larger padding for forms
  showFooter={true}
  primaryAction={{
    label: 'Save',
    onClick: handleSave,
    disabled: !isFormValid,
  }}
  secondaryAction={{
    label: 'Cancel',
    onClick: () => setOpen(false),
  }}
>
  <form onSubmit={handleSubmit}>
    {/* Form fields */}
  </form>
</Drawer>
```

### Content with Different Padding Needs

```jsx
// Compact content
<Drawer
  open={open}
  onOpenChange={setOpen}
  title="Quick Actions"
  contentPadding="var(--t-space-400)" // Smaller 16px padding
>
  {/* Compact action buttons */}
</Drawer>

// Detailed content
<Drawer
  open={open}
  onOpenChange={setOpen}
  title="Article Editor"
  contentPadding="var(--t-space-700)" // Larger 32px padding
>
  {/* Rich text editor */}
</Drawer>

// Custom asymmetric padding
<Drawer
  open={open}
  onOpenChange={setOpen}
  title="Layout Preview"
  contentPadding="3rem 1rem" // 48px vertical, 16px horizontal
>
  {/* Design preview content */}
</Drawer>
```

### Object Details with Table Data

```jsx
<Drawer
  open={open}
  onOpenChange={setOpen}
  title={`Order #${order.id}`}
  showFooter={true}
  primaryAction={{
    label: 'Process Order',
    onClick: handleProcessOrder,
  }}
  secondaryAction={{
    label: 'Close',
    onClick: () => setOpen(false),
  }}
>
  <div>
    {/* Order details */}
    <Table 
      data={orderItems} 
      columns={columns}
      // Table content will appear below the drawer
    />
  </div>
</Drawer>
```

### Multi-step Flows

```jsx
<Drawer
  open={open}
  onOpenChange={setOpen}
  title={`Step ${currentStep} of ${totalSteps}`}
  showBackButton={currentStep > 1}
  onBackClick={() => setCurrentStep(currentStep - 1)}
  showFooter={true}
  primaryAction={{
    label: currentStep === totalSteps ? 'Finish' : 'Next',
    onClick: handleNextStep,
  }}
  secondaryAction={{
    label: 'Cancel',
    onClick: () => setOpen(false),
  }}
>
  <div>
    {/* Step content */}
  </div>
</Drawer>
```

### Settings Panel

```jsx
<Drawer
  open={open}
  onOpenChange={setOpen}
  title="Settings"
  size="small"
  position="right"
>
  <div>
    {/* Settings options */}
  </div>
</Drawer>
```

## Accessibility

The Drawer component follows accessibility best practices:

- Uses a modal dialog pattern for proper focus management
- Traps focus within the drawer when open
- Closes on ESC key press
- Uses proper headings for drawer title
- Provides sufficient color contrast
- Handles keyboard navigation properly
- Maintains a logical tab order
- Properly labeled buttons (back, close)
- Uses `aria-label` for buttons without visible text
- Prevents background scrolling when drawer is open

## Implementation Details

### Z-Index Architecture

The Drawer component implements a sophisticated z-index management system:

```css
/* Z-Index Hierarchy */
:root {
  --t-z-drawer-overlay: calc(var(--t-z-modal) + 40);  /* 140 */
  --t-z-drawer-content: calc(var(--t-z-modal) + 50);  /* 150 */
  --t-z-drawer-modal: calc(var(--t-z-modal) + 100);   /* 200 */
}
```

This ensures the drawer always appears above:
- Normal content (`z-index: 0`)
- Dropdowns and selects (`z-index: 10`)
- Standard modals (`z-index: 100`)
- Table sticky headers and content (`z-index: 101`)

### CSS Variables

The Drawer component uses the following token CSS variables:

| Variable | Purpose |
|----------|---------|
| `--t-space-*` | Padding and spacing |
| `--t-color-surface-*` | Background colors |
| `--t-color-fill-*` | Button and background colors |
| `--t-color-border-*` | Border colors |
| `--t-color-text-*` | Text colors |
| `--t-color-icon-*` | Icon colors |
| `--t-font-size-*` | Font sizes |
| `--t-font-weight-*` | Font weights |
| `--t-border-radius-*` | Border radius values |
| `--t-shadow-200` | Shadow for the drawer |
| `--t-z-modal` | Base z-index for modal components |
| `--t-z-drawer-*` | Custom z-index hierarchy for drawers |
| `--t-duration-base` | Animation duration |
| `--t-easing-in-out` | Animation timing function |
| `--t-line-height-arabic` | Line height for Arabic text |
| `--t-line-height-english` | Line height for English text |

### Architecture

The component is built on Vaul's Drawer component which provides:

1. Animation and transitions for smooth entrance/exit
2. Focus management for accessibility
3. Supporting primitives for overlay and content

The Tagaddod implementation extends this with:

1. Design system integration with tokens
2. Multiple sizes and positions
3. Header and footer configurations
4. RTL language support
5. Responsive behavior for mobile devices
6. **Z-index management for complex layouts**
7. **Context provider for nested components**

### Browser Support

The Drawer component is compatible with all modern browsers and includes RTL language support.

### Mobile Behavior

On smaller screens (below 640px):
- The drawer takes the full width of the screen
- It slides up from the bottom instead of from the side
- It has a maximum height of 80% of the viewport
- It uses rounded corners at the top

## Troubleshooting

### Drawer Appears Behind Other Content

If the drawer appears behind other content (like tables or sticky elements):

1. **Check z-index conflicts**: The drawer uses `z-index: 150` by default
2. **Verify CSS custom properties**: Ensure `--t-z-modal` is properly defined
3. **Use utility classes**: Apply `.drawer-modal` class to elements that should appear above the drawer

### Modal Components Not Appearing Above Drawer

When opening modals from within a drawer:

1. **Use useDrawerContext**: Apply the hook to get the correct z-index
2. **Apply drawerZIndex**: Use the returned `drawerZIndex` value for your modal
3. **Check CSS specificity**: Ensure your modal's z-index style has sufficient specificity

### Performance Issues

For large content within drawers:

1. **Use lazy loading**: Load drawer content only when needed
2. **Optimize animations**: Use `prefers-reduced-motion` media query
3. **Limit DOM depth**: Keep drawer content structure simple

## Breaking Changes from Previous Versions

### Z-Index Management
- **Before**: Used undefined `--t-z-index-overlay` token
- **After**: Uses proper token hierarchy with `--t-z-modal` base
- **Migration**: No code changes needed - automatically resolved

### Context Provider
- **Before**: No context provided
- **After**: Provides `DrawerContext` for nested components
- **Migration**: Optional - use `useDrawerContext` for enhanced modal handling

## Best Practices

1. **Use appropriate sizes**: Choose drawer size based on content complexity
2. **Handle modal z-index**: Use `useDrawerContext` when opening modals from drawers
3. **Provide clear actions**: Use footer buttons for primary/secondary actions
4. **Support RTL**: Test drawer behavior in both LTR and RTL languages
5. **Consider mobile**: Design drawer content for smaller screens
6. **Accessibility first**: Ensure keyboard navigation and screen reader compatibility
